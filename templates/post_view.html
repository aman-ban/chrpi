{% extends "base.html" %}

{% block title %}Post by {{ post.username }}{% endblock %}

{% block content %}
<div class="single-post-container">

    {% if post is defined and post %}

    <div class="single-post-header">
        <a href="{{ url_for('user_profile', username=post.username) }}" class="back-to-profile">
            ‚Üê Back to @{{ post.username }}'s profile
        </a>
    </div>

    <div class="post-card single-post-card">

        {% if post.image %}
            <img src="{{ post.image }}"
                 class="post-image-large"
                 alt="Post Image">
        {% endif %}

        <div class="post-body">

            {% if post.content %}
                <div class="single-post-content">{{ post.content }}</div>
            {% endif %}

            {% if post.link %}
            <div class="single-post-link">
                <a href="{{ post.link }}" class="story-link" target="_blank" rel="noopener noreferrer">
                    üîó Read External Source
                </a>
            </div>
            {% endif %}

            <div class="section-divider"></div>

            <div class="single-post-footer">

                <div class="post-meta-single">
                    <span class="post-author-label">Posted by</span>
                    <a href="{{ url_for('user_profile', username=post.username) }}" class="post-author-link">
                        @{{ post.username }}
                    </a>
                    <span class="post-divider">‚Ä¢</span>
                    <span class="post-timestamp">{{ post.timestamp }}</span>
                </div>

                <div class="single-post-reactions">
                    {% for emoji in allowed_emojis %}
                    <form action="{{ url_for('smile', post_id=post.id) }}" method="POST" class="reaction-form">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <input type="hidden" name="reaction" value="{{ emoji }}">

                        <button type="submit"
                                class="reaction-btn {{ 'reaction-btn-active' if post.user_reaction == emoji else '' }}">
                            <span class="reaction-emoji">{{ emoji }}</span>
                            {% if post.reaction_counts_dict[emoji] > 0 %}
                                <span class="reaction-count">{{ post.reaction_counts_dict[emoji] }}</span>
                            {% endif %}
                        </button>
                    </form>
                    {% endfor %}
                </div>
            </div>

        </div>
    </div>

    {% else %}
        <div class="empty-state">
            <div class="empty-state-emoji">üòï</div>
            <h3>Post Not Found</h3>
            <p>Sorry, we couldn't find that particular post.</p>
            <a href="{{ url_for('feed') }}" class="btn btn-primary">
                Return to Feed
            </a>
        </div>
    {% endif %}

</div>
{% endblock %}