<div class="post-card">
    <div class="post-card-header">
        <a href="{{ url_for('user_profile', username=post.username) }}" class="post-avatar-link">
            <img src="{{ post.profile_image if post.profile_image else url_for('static', filename='default-profile.png') }}"
                 alt="{{ post.username }}"
                 class="post-avatar">
        </a>
        <div class="post-user-info">
            <a href="{{ url_for('user_profile', username=post.username) }}" class="post-username-link">
                {{ post.username }}
            </a>
            <div class="post-timestamp">{{ post.timestamp|datetime }}</div>
        </div>

        {% if user and user.id == post.user_id %}
        <form action="{{ url_for('delete_post', post_id=post.id) }}"
              method="POST"
              class="post-delete-form"
              onsubmit="return confirm('Are you sure you want to delete this post?');">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="post-delete-btn">Delete</button>
        </form>
        {% endif %}
    </div>

    {% if post.content %}
    <div class="post-content">
        {{ post.content }}
    </div>
    {% endif %}

    {% if post.image %}
    <a href="{{ url_for('view_single_post', post_id=post.id) }}" class="post-image-link">
        <img src="{{ post.image }}" alt="Post image" class="post-image">
    </a>
    {% endif %}

    {% if post.link and not post.image %}
    <a href="{{ post.link }}" target="_blank" rel="noopener noreferrer" class="post-link-card">
        <span class="post-link-icon">ðŸ”—</span>
        <span class="post-link-text">{{ post.link }}</span>
    </a>
    {% endif %}

    <div class="post-reactions">
        {% for emoji in allowed_emojis %}
        <form action="{{ url_for('smile', post_id=post.id) }}" method="POST" class="reaction-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="reaction" value="{{ emoji }}">

            <button type="submit"
                    class="reaction-btn {{ 'reaction-btn-active' if post.user_reaction == emoji else '' }}">
                <span class="reaction-emoji">{{ emoji }}</span>
                {% if post.reaction_counts_dict[emoji] > 0 %}
                    <span class="reaction-count">{{ post.reaction_counts_dict[emoji] }}</span>
                {% endif %}
            </button>
        </form>
        {% endfor %}
    </div>
</div>